# フィールドBGM継続再生の対応計画

## ゴール
- FieldView で流している BGM を、バトル以外の遷移（カード／レリック報酬画面など）では途切れさせず継続再生させる。
- バトル開始時の BGM 切り替えは既存仕様を尊重し、意図的に止める／切り替える必要がある場合のみ制御する。

## 現状整理
- `FieldView` がマウント時に `audioStore.playBgm('/sounds/bgm/field.mp3')` を呼び、アンマウント時に `audioStore.stopBgm()` を呼ぶため、報酬画面へ遷移すると BGM が止まる。
- 報酬系ビュー（カード／レリック／ランダム報酬など）は BGM 再生を行っていない。
- `audioStore` はグローバルに BGM を管理できる構造のため、停止タイミングを緩和すれば継続が可能。

## 対応方針
1. **FieldView の BGM 停止条件を緩和**  
   - フィールド→報酬系遷移では stopBgm しない。バトル遷移やタイトルへ戻るなど、明示的に切り替えたいタイミングだけ停止/変更する。
2. **報酬ビュー側での BGM ポリシー決定**  
   - 既存 BGM をそのまま維持する（デフォルト）。必要なら「BGMが無い場合だけフィールドBGMを再生」などのフォールバックを実装。
3. **ハブ未初期化時の安全策**  
   - 現状 fallback hub があるため大きな変更は不要だが、BGMが止まったままになるケースがないか確認。
4. **回帰確認**  
   - フィールド→報酬→フィールドで BGM が途切れないことを確認。フィールド→バトルでバトルBGMが適切に再生・終了することも合わせて確認。

## 不明点と選択肢
1. **どの画面で BGM を停止させるべきか？**  
   - 選択肢A: フィールド離脱時はバトル遷移のみ停止し、他は継続（推奨）。  
   - 選択肢B: タイトル/デッキ等でも停止するが報酬だけ継続。  
   - 選択肢C: 画面ごとに専用BGMを個別再生する（実装工数増）。  
   - **推奨**: A。最小変更で要望を満たす。
2. **報酬画面で BGM が未再生だった場合のフォールバックは必要か？**  
   - 選択肢A: FieldView から遷移した場合のみ継続する前提でフォールバックなし（推奨）。  
   - 選択肢B: 報酬画面マウント時に BGM 未再生ならフィールドBGMをかけ直す。  
   - **推奨**: A。シンプルに停止しないだけに留める。
3. **バトル終了後のBGM**  
   - 選択肢A: BattleView が終了時に stopBgm せず、フィールド復帰時にフィールドBGMを再生し直す（推奨）。  
   - 選択肢B: BattleView 終了時にフィールドBGMを再生開始する。  
   - **推奨**: A。画面単位で責務を分離。

## 実装ステップ案
1. `FieldView` のアンマウントで無条件に `stopBgm()` している箇所を見直し、バトル遷移時のみ停止するなど条件付きに変更。  
2. 報酬ビュー（カード/レリック/ランダム/固定）での BGM 制御を確認し、不要な停止呼び出しが無いことを保証。  
3. BattleView が開始/終了時に行う BGM 制御を確認し、フィールド復帰時にフィールドBGMを再生する流れを維持。  
4. 手動確認: フィールド→各報酬画面→フィールドで BGM が継続、フィールド→バトルでバトルBGMへ切替＋バトル終了後にフィールドBGMへ戻ることを確認。
