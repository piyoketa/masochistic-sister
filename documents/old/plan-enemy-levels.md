# 敵レベル導入 計画書

## 目的
- 全ての敵にレベル概念を導入し、レベルに応じたステータス変化や状態量を持たせる。
- 敵チーム生成時に「追加分レベル」を受け取り、メンバーへランダムに割り振る仕組みを追加する。
- SecondField ではボス以外のチーム呼び出し時に追加分レベル=2 を適用する。

## 実装方針
- 敵共通:
  - Enemy/派生クラスのコンストラクタに `level?: number` を追加し、内部でレベル別パラメータを適用する仕組みを作る。
  - レベルごとの設定は各敵クラス内で `applyLevelConfig(level)` のような専用メソッドに分離し、デフォルト（Lv1）/Lv2/Lv3…を切り替える。
  - 既存の引数による上書き（props override）はレベル適用後に反映し、優先度: 引数 > レベル設定 > デフォルトとする。
  - レベル未定義の数値が指定された場合の扱い（例: Lv4）を決める（下記不明点）。
- 敵チーム:
  - `EnemyTeam` 生成時に `bonusLevels?: number` を受け取り、メンバー数を上限としたランダム割り振りを行う。
  - 割り振りロジック: bonusLevels 回ループし、毎回 `members` からランダムに1体選び、その敵のレベルを +1 して再生成/再設定する。結果として同一個体へ重ね掛けも起こり得る。
  - ボスチームは bonusLevels を無視するか 0 固定にする（要求に従い SecondField ではボス除外）。
  - 乱択は Math.random を利用予定（再現性が不要であれば）。必要ならシード対応を検討（下記不明点）。
- SecondField:
  - ボス以外のチーム生成箇所で `bonusLevels: 2` を渡す。
  - ボス生成は現状通り。
- 例（SnailEnemy）:
  - Lv1: 既存値（HPなど）
  - Lv2: HP 20
  - Lv3: HardShellState magnitude 25
  - これを `applyLevelConfig` で分岐。

## 作業ステップ案
1. **設計土台追加**: Enemy/EnemyTeam にレベル/追加分レベルの型定義・ユーティリティを導入（ベースクラス or ヘルパー）。
2. **敵クラス改修**: SnailEnemy から着手し、各敵に level パラメータとレベル別設定を追加。既存オプション上書き優先を担保。
3. **チーム改修**: 各 EnemyTeam コンストラクタで `bonusLevels` を受け取り、メンバーへランダム割当して生成する処理を共通化（ヘルパー利用）。
4. **フィールド改修**: SecondField の非ボスチーム呼び出しに bonusLevels=2 を渡す。その他フィールドへの影響確認。
5. **動作確認**: type-check、主要敵/チーム生成の簡易テスト（ユニットまたはスモーク）でレベル適用を確認。

## 決定事項（回答反映）
- 未定義レベルは最後に定義されたレベルへ張り付きで処理する。
- 乱択は Math.random を使用する（シード不要）。
- ボスは常にレベル固定（追加分レベルは無視）。
- レベル3以降のパラメータは SnailEnemy 以外もこちらで個別に設定してよい。
