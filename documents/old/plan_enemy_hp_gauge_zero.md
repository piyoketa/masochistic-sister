# 敵HPゲージの0表示アニメーション改善 計画

## 背景・課題
- 敵が撃破された際、`HpGauge` が 0 まで減少するアニメーションを見る前にコンポーネントが `v-if` で消えるため、0 表示が確認できない。
- `BattleEnemyArea` では `enemySnapshot.status === 'active' && currentHp > 0` の条件で `EnemyCard` を描画しており、`currentHp === 0` になった瞬間にカードが非表示になると推測。

## ゴール
- 敵撃破時に HP ゲージが 0 まで減少するアニメーションが確実に表示される。
- 撃破後の UI の整合性（サウンド・演出・リスト表示）を維持する。

## 対応方針（案）
- 撃破直後も `EnemyCard` を一時的に残し、`HpGauge` が 0 になるフレームが描画されるようにする。
- 「表示する/しない」の判定を HP 値だけでなくステータス・演出完了状況で管理し、`defeat` ステージイベントと整合させる。
- 撃破状態のカードには「撃破」スタイル（非アクティブ・入力不可）を適用する。

## 実装タスク案
1. **現状確認**: `BattleEnemyArea` の `isActive` 判定とスナップショットの `status` / `currentHp` 推移を確認し、撃破直後に `EnemyCard` が除去される箇所を特定する。必要なら `Battle` 側のスナップショット生成も確認。
2. **表示条件の見直し**: `currentHp === 0` でも短時間は `EnemyCard` を残す条件を設計する。例:
   - `status` が `defeated` になるまでは表示を維持する。
   - または撃破イベント受信後に一定時間（アニメーション完了まで）カードを残すフラグを持つ。
3. **UIスタイル調整**: 撃破状態のカードに半透明・入力不可などのスタイルを適用し、選択・ホバーを無効化する。
4. **イベント同期**: `defeat` ステージイベントでサウンド再生と併せ、表示終了のトリガーを統一する（サウンド再生後に非表示にするか、次のスナップショット更新時に消すかを決める）。
5. **テスト・確認**: 実機で敵撃破時に HP が 0 までアニメすることを確認。可能ならユニット/スナップショットテストで `currentHp === 0` の描画条件を検証。

## 確認が必要な点・選択肢
1. **撃破カードの表示タイミング**  
   - 選択肢A: `status` が `defeated` になるまでは表示を維持（`currentHp` は 0 でも OK）。  
   - 選択肢B: `defeat` アニメーション完了まで（例えば一定時間）表示を維持し、その後非表示にする。  
   - 選択肢C: 常に表示維持し、「撃破」スタイルのまま場に残す（消さない）。  
   - おすすめ: **選択肢A**。ロジックが単純で、`Battle` スナップショットの状態遷移と整合を取りやすい。
   -> 選択肢A
2. **撃破中の入力扱い**  
   - 選択肢A: 撃破状態は選択不可（クリック/ホバー無効）。  
   - 選択肢B: 選択はできるが何も起こらない。  
   - おすすめ: **選択肢A**。誤操作防止と UI 意図の明確化のため。
   -> 選択肢A
3. **表示終了のトリガー**  
   - 選択肢A: `Battle` のスナップショットで `status` が `defeated` から `removed` へ遷移したタイミングで非表示。  
   - 選択肢B: defeat サウンド再生後に一定ディレイで非表示。  
   - おすすめ: 現行スナップショット設計が明確であれば **選択肢A**。遷移が未定義なら、短いディレイを併用する案も検討。
   -> 選択肢A
