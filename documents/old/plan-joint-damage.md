# 関節損傷効果変更 計画

## 背景・目的
State「関節損傷」の効果を、現行の「一回攻撃の被ダメージを割合増加」から「殴打による被ダメージ+20」へ変更し、仕様に沿ったダメージ計算になるよう調整する。

## 作業方針
- 関節損傷の効果を `JointDamageState` で完結させ、他のStateや攻撃種別判定には影響を与えない。
- 「殴打」判定は攻撃コンテキストから安全に得られる情報を使い、攻撃回数での判定は禁止（`DamagePattern`の型やAttack名を利用）。
- 変更に伴う説明文や表示テキストも整合させる。

## 実装ステップ
1. `JointDamageState` の現仕様を再確認し、ダメージ計算で参照できる攻撃名/識別子を整理する（`modifyPreHit` に渡る `context.attack` など）。
2. 仕様が確定したら `JointDamageState` を改修し、攻撃が「殴打」の場合のみ被ダメージを+20（または決定した量）するロジックに置き換え、説明文も更新する。
3. 関連ドキュメント（`documents/STATE.md` など）に効果文言を反映する。
4. テストを追加/更新し、「殴打」だけが+20されること、他攻撃への影響がないことを検証する。
5. 必要に応じて既存のスナップショットや演出への影響がないか手動確認し、完了報告する。

## テスト計画
- 単体: `JointDamageState` が「殴打」攻撃を受けたときだけダメージが+20されることを確認するテストを追加。
- 単体: 「殴打」以外の攻撃（例: 乱れ突きや溶かす）では影響しないことを確認。
- （必要なら）多重付与時の挙動を決めてから、その期待どおりに加算されるか検証。

## 決定事項（ユーザー回答反映）
- 加算量: magnitudeを1スタック=+20として加算（選択肢B）。
- 加算タイミング: pre-hitでamountに加算。State優先度は20へ引き下げ。
- 判定範囲: 攻撃が`TackleAction`クラスである場合に適用（名称ではなくクラス判定）。敵/味方どちらの攻撃でも該当。
- 加算単位: 1ヒットあたり+20（countが変動しても1ヒットごとに適用）。
