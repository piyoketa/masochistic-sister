# BattleView デッキ表示分離計画

## 目的
- ヘッダーの「デッキ:x枚」ボタンではプレイヤー保存デッキ（playerStore）をID昇順で表示する。
- BattleView内の `.hand-counter--deck` クリックでは、従来通りバトル中の山札（battle.deck）を表示する。
- 2経路の表示を両立し、表示内容の混線を防ぐ。

## 実装タスク案
1) 呼び出し経路の整理  
   - BattleView でデッキオーバーレイを開くトリガーを洗い出し、ヘッダー・ハンドの2経路を明確にする。  
   - 現状 `openDeckOverlay` を両方で共有しているため、ヘッダー用/戦闘中山札用の関数を分割する。
2) ヘッダー用: playerStoreデッキ（ID昇順）の維持  
   - 既存の `deckCardInfos` (playerStoreベース) をヘッダー専用にし、ソート・シャッフルなしを維持。  
   - `@deck-click` などヘッダー側のイベントはこの関数を呼ぶように限定する。
3) ハンド用: battle.deck ベースに回帰  
   - 新たに `battleDeckCardInfos` を `snapshot.deck` から生成。従来仕様を踏襲するため表示順はシャッフルする（秘匿目的）。  
   - HandArea からの `open-deck-overlay` はこの関数を呼ぶ。  
   - オーバーレイ表示中に山札が変化した場合は、Battle版のシャッフルロジックで再描画する。
4) ステート同期の調整  
   - `watch(deckCardInfos)` の再描画対象をヘッダー版/バトル版で分離し、`pileOverlayStore.activePile === 'deck'` のとき、どのソースで開いているかを判別するためのフラグまたは直近呼び出しのメモを持たせる。  
   - フラグが難しい場合は、オーバーレイオープン時に `mode: 'player' | 'battle'` を store へ渡す形にする。
5) 回収・テスト  
   - 表示切替のユニットテストは困難なため、ロジック部分を小さな関数（カード情報ビルダー）として分け、メソッド単体のテスト（playerStoreソート、battle.deckシャッフル）を追加。  
   - 手動確認: ヘッダーから開く→ID順で固定表示、ハンドカウンターから開く→従来のランダム順＋戦闘中のデッキ変動が反映されることを確認。

## 不明点・要確認
- バトル中山札の表示順: 以前の「毎回シャッフルで秘匿」を維持して良いか？（推奨: 維持）
- ヘッダーとハンドでオーバーレイを同時に開くケースへの優先度: 直近の呼び出し優先で良いか？（推奨: 直近優先し、modeを上書き）
- ハンドの「デッキ:x枚」ラベルが他のビューにも存在するか: BattleViewのみかどうか確認。  
  推奨: BattleViewのみを対象に実装し、他ビューでは現状の playerStore 表示を維持。
